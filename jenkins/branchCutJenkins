pipeline {
  agent {
    node {
      label 'windows'
    }
  }

  parameters {
    string(name: 'BASE_BRANCH', defaultValue: 'release-8.5.x', description: 'Base branch')
    string(name: 'NEW_BRANCH',  description: 'New branch to create (e.g. release-8.5.1)')
    string(name: 'CURRENT_VERSION', description: 'Current version in pom.xml (e.g., 8.5.0)')
    string(name: 'NEW_VERSION', description: 'New version to set in pom.xml (e.g., 8.5.1)')
  }

  stages {

    stage('Checkout Base Branch') {
      steps {
        git branch: "${params.BASE_BRANCH}",
            url: 'https://github.com/rushikeshraskar/spring-auth-app.git/',
            credentialsId: 'f97287c6-60a4-439b-ad3e-d8afbec1ffd7'
      }
    }

stage('Cut Release Branch') {
  steps {
    withCredentials([usernamePassword(
      credentialsId: 'f97287c6-60a4-439b-ad3e-d8afbec1ffd7',
      usernameVariable: 'GIT_USER',
      passwordVariable: 'GIT_TOKEN'
    )]) {
      bat '''
        git config user.name "jenkins"
        git config user.email "jenkins@ci.local"
        git remote set-url origin https://%GIT_USER%:%GIT_TOKEN%@github.com/rushikeshraskar/spring-auth-app.git
        call scripts\\cut-release.bat %BASE_BRANCH% %NEW_BRANCH% %CURRENT_VERSION% %NEW_VERSION%
      '''
    }
  }
}

  }

  post {
    success {
      echo "üéâ Branch ${params.NEW_BRANCH} created from ${params.BASE_BRANCH}"
    }
    failure {
      echo "‚ùå Branch cut failed"
    }
  }
}
